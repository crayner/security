!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(){null===R&&(R=t.localStorage?t.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{})}function n(t,o){z.multiWindowSupport?R.set(t,o):R[t]=o}function e(t,o){if(o="undefined"==typeof o?null:o,z.multiWindowSupport){if(R.isSet(t))return R.get(t)}else if(t in R)return R[t];return o}function l(){n("warningStartTime",-1),n("lockStartTime",-1),i(),z.idleCallback!==!1&&z.idleCallback(z)}function i(){a(),n("lastActivity",t.now()),Z=setInterval(r,z.idleCheckHeartbeat)}function a(){clearInterval(Z)}function r(){var o=e("lastActivity",t.now())+z.idleTimeLimit;return e("logoutTriggered")===!0?N():e("lockStartTime",-1)!==-1?(a(),A()):t.now()>=o?(a(),z.warnEnabled?d():z.lockEnabled?L():O()):void 0}function c(){t(document).on(z.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===ot[0]&&t.clientY===ot[1])return;ot[0]=t.clientX,ot[1]=t.clientY}e("warningStartTime",-1)===-1&&e("lockStartTime",-1)===-1&&i()})}function u(){s(),$=setInterval(function(){t.ajax({type:z.keepAliveAjaxType,url:z.keepAliveUrl,data:z.keepAliveAjaxData})},z.keepAliveInterval)}function s(){clearInterval($)}function d(){k(),z.warnCallback!==!1&&(nt=z.warnCallback(z)),w()}function p(){f(),b(),n("warningStartTime",-1),l()}function k(){n("warningStartTime",t.now()),_=setInterval(m,500)}function f(){clearInterval(_)}function m(){if(e("logoutTriggered")===!0)return f(),N();if(e("warningStartTime",-1)===-1)return p();var o=e("warningStartTime")+z.warnTimeLimit-1;return t.now()>=o?(f(),z.lockEnabled?(b(),L()):O()):void v()}function w(){nt&&(g(),v(),z.bootstrap?(lt.modal("show"),lt.focus()):lt.dialog("open"),et=!0)}function b(){et=!1,null!==lt&&(z.bootstrap?(lt.modal("hide"),F.removeClass("modal-open"),t("div.modal-backdrop").remove()):lt.dialog("close"))}function v(){if(null!==lt&&(null!==it||null!==at)){var o=t.now(),n=Math.floor((e("warningStartTime",o)+z.warnTimeLimit-o)/1e3);if(null!==it&&it.html(G(n)),null!==at){var l=Math.floor(n/(z.warnTimeLimit/1e3)*100);z.bootstrap?at.css("width",l+"%"):at.progressbar("value",l)}}}function g(){if(null===lt){var t="";t=z.warnContentCallback===!1?z.bootstrap?j():C():z.warnContentCallback(z),z.bootstrap?y(t):T(t)}}function y(o){F.append(o),null!==z.warnLogoutButton&&t("#jitp-warn-logout").on("click",function(){h()}),t("#jitp-warn-alive").on("click",function(){S()}),lt=t("#jitp-warn-display"),(null!==z.warnCountdownMessage||z.warnCountdownBar)&&(it=lt.find(".jitp-countdown-holder")),z.warnCountdownBar&&(at=t("#jitp-warn-bar"))}function T(o){var n=[];null!==z.warnLogoutButton&&n.push({text:z.warnLogoutButton,click:function(){h()}}),n.push({text:z.warnStayAliveButton,click:function(){S()}}),t(o).dialog({buttons:n,closeOnEscape:!1,modal:!0,title:z.warnTitle,minWidth:320,autoOpen:!1,open:function(){null===z.warnTitle?t(this).closest(".ui-dialog").find(".ui-dialog-titlebar").hide():t(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),t(this).parent().find("button:nth-child(2)").focus()}}),lt=t("#jitp-warn-display"),null!==z.warnCountdownMessage&&(it=lt.find(".jitp-countdown-holder")),z.warnCountdownBar&&(at=t("#jitp-warn-bar"),at.progressbar({value:0,max:100}))}function j(){var t=null===z.warnTitle?"":'<div class="modal-header"><h4 class="modal-title">'+z.warnTitle+"</h4></div>",o=null===z.warnCountdownMessage?"":"<p>"+z.warnCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>",n=null===z.warnLogoutButton?"":'<button id="jitp-warn-logout" type="button" class="btn btn-default">'+z.warnLogoutButton+"</button>",e=null===z.warnCountdownBar?"":'<div class="progress"><div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;"><span class="jitp-countdown-holder"></span></div></div>';return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+t+'<div class="modal-body"><p>'+z.warnMessage+"</p>"+o+e+'</div><div class="modal-footer">'+n+'<button id="jitp-warn-alive" type="button" class="btn btn-primary">'+z.warnStayAliveButton+"</button></div></div></div></div>"}function C(){var t=null===z.warnCountdownMessage?"":"<p>"+z.warnCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>",o=null===z.warnCountdownBar?"":'<div id="jitp-warn-bar"></div>';return'<div id="jitp-warn-display"><p>'+z.warnMessage+"</p>"+t+o+"</div>"}function h(){f(),D()}function S(){p()}function L(){z.lockHaltKeepAlive&&s(),M(),z.lockCallback!==!1&&(rt=z.lockCallback(z)),x()}function A(){z.lockHaltKeepAlive?s():z.keepAliveInterval&&u(),e("lockStartTime",-1)===-1?M():tt=setInterval(B,500),x()}function U(){I(),E(),t("#jitp-lock-pass").val(""),z.keepAliveInterval&&u(),n("lockStartTime",-1),l()}function M(){n("lockStartTime",t.now()),tt=setInterval(B,500)}function I(){clearInterval(tt)}function B(){if(e("logoutTriggered")===!0)return I(),N();if(e("lockStartTime",-1)===-1)return U();var o=e("lockStartTime")+z.lockTimeLimit-1;return t.now()>=o?(I(),e("logoutTriggered")===!0?N():O()):void q()}function x(){if(rt){W(),q();var o={message:t("#jitp-lock-display")};o=t.extend(o,z.lockBlockUiConfig),t.blockUI(o),ct=!0}}function E(){t.unblockUI(),ct=!1}function q(){if(null!==st){var o=t.now(),n=Math.floor((e("lockStartTime",o)+z.lockTimeLimit-o)/1e3);st.html(G(n))}}function W(){if(null===ut){var o="";o=z.lockContentCallback===!1?z.bootstrap?P():H():z.lockContentCallback(z),F.append(o),ut=t("#jitp-lock-display"),z.lockCountdownMessage!==!1&&(st=ut.find(".jitp-countdown-holder")),t("#jitp-lock-logout").on("click",function(){K()}),t("#jitp-lock-unlock").on("click",function(){Q()}),t("#jitp-lock-form").length&&t("#jitp-lock-form").submit(function(){return Q(),!1}),q()}}function P(){var t=null===z.lockTitle?"":'<div class="panel-heading"><h2 class="panel-title">'+z.lockTitle+"</h2></div>",o=z.lockLogoutButton.replace(/\{username}/g,z.lockUsername),n=null===z.lockCountdownMessage?"":'<div class="panel-footer">'+z.lockCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</div>";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;"><div class="panel panel-default jitp-lock-panel">'+t+'<div class="panel-body"><h4>'+z.lockUsername+"</h4><p>"+z.lockMessage+'</p><div class="input-group"><input id="jitp-lock-pass" type="password" class="form-control" placeholder="Password..."/><span class="input-group-btn"><button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+z.lockUnlockButton+'</button></span></div><a id="jitp-lock-logout" href="javascript:;">'+o+"</a></div>"+n+"</div></div>"}function H(){var t=null===z.lockTitle?"":"<header>"+z.lockTitle+"</header>",o=z.lockLogoutButton.replace(/\{username}/g,z.lockUsername),n=null===z.lockCountdownMessage?"":"<footer>"+z.lockCountdownMessage.replace(/\{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;"><div class="jitp-lock-panel jitp-lock-jqpanel">'+t+'<div class="jitp-lock-jqpanel-body"><h2>'+z.lockUsername+"</h2><p>"+z.lockMessage+'</p><div><input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/></div><button id="jitp-lock-unlock" type="button">'+z.lockUnlockButton+'</button><a id="jitp-lock-logout" href="javascript:;">'+o+"</a></div>"+n+"</div></div>"}function K(){I(),D()}function Q(){z.lockPassCallback(t("#jitp-lock-pass").val())}function Y(){s(),a(),f(),I()}function D(){Y(),n("logoutTriggered",!0),("function"!=typeof z.logoutCallback||z.logoutCallback(z))&&window.location.replace(z.logoutUrl)}function N(){Y(),("function"!=typeof z.logoutAutoCallback||z.logoutAutoCallback(z))&&window.location.replace(z.logoutAutoUrl)}function O(){return Y(),z.multiWindowSupport?void setTimeout(X,J(100,500)):X()}function X(){return e("logoutTriggered",!1)?N():(n("logoutTriggered",!0),void(("function"!=typeof z.redirectCallback||z.redirectCallback(z))&&window.location.replace(z.redirectUrl)))}function G(t){var o=Math.floor(t/60);if(o<=15){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(o<=75)return o<=22?"about 15 mins":o<=37?"about 30 mins":o<=52?"about 25 mins":"about 1 hour";var l=Math.floor(o/60);return o%=60,o<=15?"about "+l+" hours":o>52?"about "+(l+1)+" hours":"about "+l+"&frac12; hours"}function J(t,o){return Math.floor(Math.random()*(o-t))+t}var z={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,bootstrap:!1,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,redirectUrl:"/timed-out",logoutUrl:"/logout",logoutAutoUrl:"null",redirectCallback:!1,logoutCallback:!1,logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},lockLoadActive:!1,multiWindowSupport:!1},F=t("body"),R=null,V={};V.start=function(l){if(z=t.extend(z,l),null===z.logoutAutoUrl&&(z.logoutAutoUrl=z.logoutUrl),z.idleTimeLimit*=1e3,z.idleCheckHeartbeat*=1e3,z.warnTimeLimit*=1e3,z.lockTimeLimit*=1e3,z.keepAliveInterval*=1e3,z.multiWindowSupport&&!t.localStorage)return console.error("jitp: Multi-Window support requested but JQuery Storage API is unavailable."),!1;if(z.warnEnabled&&z.warnCallback===!1||z.lockEnabled&&z.lockCallback===!1)if(z.bootstrap){if("undefined"==typeof t.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof t.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(z.lockEnabled&&!z.multiWindowSupport)return console.error("jitp: Lock screen requested but multi-window support is not enabled."),!1;if(z.lockEnabled&&z.lockCallback===!1){if("undefined"==typeof t.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable."),!1;if(z.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set."),!1}return o(),z.lockEnabled&&(z.lockLoadActive||e("lockStartTime",-1)>0)?A():(n("logoutTriggered",!1),n("warningStartTime",-1),n("lockStartTime",-1),n("lastActivity",t.now()),i(),z.keepAliveInterval&&u()),z.keepAliveInterval&&u(),c(),!0},V.cleanUpLockScreen=function(){o(),t.localStorage&&R.set("lockStartTime",-99)},V.logout=function(){D()},V.displayWarning=function(){w()},V.displayLockScreen=function(){x()},V.initLockScreen=function(){a(),f(),L()},V.setIdleTimeLimit=function(t){"number"==typeof t&&(z.idleTimeLimit=1e3*t,V.rollback())},V.setWarnTimeLimit=function(t){"number"==typeof t&&(z.warnTimeLimit=1e3*t,V.rollback())},V.setLockTimeLimit=function(t){"number"==typeof t&&(z.lockTimeLimit=1e3*t,V.rollback())},V.rollback=function(){U(),p()};var Z,$,_,tt,ot=[-1,-1],nt=!0,et=!1,lt=null,it=null,at=null,rt=!0,ct=!1,ut=null,st=null;return V});